apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: go-unit-test
  annotations:
    tekton.dev/title: "Go Unit Test Task"
spec:
  workspaces:
    - name: source
  params:
    - description: The go command used to run the go unit test
      name: GO_TEST_COMMAND
      type: string
      default: go test ./...
    - description: The Go base image used to run the unit tests
      name: GO_BASE_IMAGE
      type: string
      default: registry.redhat.io/ubi9/go-toolset:9.7@sha256:838025097bf0f160ce0d764e80e4d5692df7096abec2c73e2fed26a1976c4f70
  steps:
    - name: run-tests
      image:  $(params.GO_BASE_IMAGE)
      workingDir: $(workspaces.source.path)/source
      script: |
        #!/usr/bin/env sh
        go mod vendor
        $(params.GO_TEST_COMMAND)
